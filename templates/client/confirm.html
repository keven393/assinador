<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmação - Assinatura Digital</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/font-awesome.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
</head>
<body class="client-confirm-body">
    <div class="container">
        <div class="client-container client-confirm-container">
            <!-- Header -->
            <div class="client-header client-confirm-header">
                <div class="logo-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h2 class="mb-2">Confirmação de Dados</h2>
                <p class="mb-0">Revise as informações e aceite os termos</p>
            </div>

            <!-- Body -->
            <div class="client-body client-confirm-body-section">
                <!-- Mensagens Flash -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Informações do Cliente -->
                <div class="info-card client-confirm-info-card">
                    <h5 class="mb-3">
                        <i class="fas fa-user me-2 text-success"></i>
                        Seus Dados
                    </h5>
                    <div class="client-name">{{ client_data.client_name }}</div>
                    <div class="client-cpf mb-2">
                        CPF: {{ client_cpf|cpf }}
                    </div>
                    
                    {% if client_data.client_email %}
                    <div class="client-info-item">
                        <i class="fas fa-envelope me-2 text-muted"></i>
                        <strong>Email:</strong> {{ client_data.client_email }}
                    </div>
                    {% endif %}
                    
                    {% if client_data.client_phone %}
                    <div class="client-info-item">
                        <i class="fas fa-phone me-2 text-muted"></i>
                        <strong>Telefone:</strong> {{ client_data.client_phone }}
                    </div>
                    {% endif %}
                    
                    {% if client_data.client_birth_date %}
                    <div class="client-info-item">
                        <i class="fas fa-calendar me-2 text-muted"></i>
                        <strong>Data de Nascimento:</strong> {{ client_data.client_birth_date.strftime('%d/%m/%Y') }}
                    </div>
                    {% endif %}
                    
                    {% if client_data.client_address %}
                    <div class="client-info-item">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        <strong>Endereço:</strong> {{ client_data.client_address }}
                    </div>
                    {% endif %}
                </div>

                <!-- Lista de Documentos -->
                <div class="document-list client-confirm-document-list">
                    <h5 class="mb-3">
                        <i class="fas fa-file-pdf me-2 text-primary"></i>
                        Documentos Pendentes ({{ documents|length }})
                    </h5>
                    {% for doc in documents %}
                    <div class="document-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ doc.original_filename }}</strong>
                                <br>
                                <small class="text-muted">
                                    Enviado em: {{ doc.timestamp.strftime('%d/%m/%Y %H:%M') }}
                                </small>
                            </div>
                            <span class="badge bg-warning">
                                <i class="fas fa-clock me-1"></i>Pendente
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Termos de Aceite -->
                <div class="terms-section client-confirm-terms-section">
                    <h5 class="mb-3">
                        <i class="fas fa-gavel me-2 text-warning"></i>
                        Termo de Aceite para Assinatura Digital
                    </h5>
                    
                    <div class="terms-text client-confirm-terms-text">
                        <strong>TERMO DE ACEITE PARA ASSINATURA ELETRÔNICA</strong><br><br>
                        
                        <strong>O que é Assinatura Eletrônica?</strong><br>
                        Para os fins deste termo, entende-se por:<br>
                        • <strong>Assinatura Digital:</strong> Conjunto de dados eletrônicos que permitem identificar o signatário e garantir a integridade do documento.<br>
                        • <strong>Documento:</strong> Arquivo eletrônico que será objeto da assinatura digital.<br>
                        • <strong>Signatário:</strong> Pessoa física que assina o documento digitalmente.<br><br>
                        
                        <strong>Validade Legal</strong><br>
                        A assinatura eletrônica tem o mesmo valor que a assinatura feita à mão, conforme a Lei nº 14.063, de 23 de setembro de 2020 - Dispõe sobre o uso de assinaturas eletrônicas em interações com entes públicos.<br><br>
                        De acordo com a legislação supracitada, em seu artigo 5º, § 1º, inciso I, dispõe-se que a assinatura eletrônica simples poderá ser admitida nas interações com o ente público quando se tratar de atos de menor relevância e que não envolvam informações submetidas a grau de sigilo.<br><br>
                        
                        <strong>Responsabilidades do Cidadão (Signatário)</strong><br><br>
                        • Ter ciência de que é necessário ter capacidade legal para a assinatura;<br>
                        • Ler e compreender a documentação a ser assinada;<br>
                        • Estar ciente de que é responsável pelo uso da assinatura eletrônica e pelas consequências legais do ato de assinar.<br><br>
                        
                        <strong>Características técnicas</strong><br>
                        • A assinatura utiliza criptografia RSA-SHA256 para garantir a segurança.<br>
                        • Cada assinatura possui timestamp certificado para comprovação temporal.<br>
                        • O sistema garante a integridade e autenticidade do documento assinado.<br><br>
                        
                        <strong>Segurança</strong><br><br>
                        O sistema utilizado protege os dados pessoais e garante a integridade do documento, conforme a lei LEI Nº 13.709, DE 14 DE AGOSTO DE 2018 - Lei Geral de Proteção de Dados Pessoais (LGPD).<br><br>
                        
                        • Todas as assinaturas ficam registradas para conferência e rastreabilidade.<br>
                        • O acesso é controlado e monitorado para evitar usos indevidos.<br><br>
                        
                        <strong>Exceções</strong><br>
                        O disposto da lei LEI Nº 14.063, DE 23 DE SETEMBRO DE 2020 que dispõe sobre o uso de assinaturas eletrônicas em interações com entes públicos, não se aplica:<br><br>
                        I - aos processos judiciais;<br>
                        II - à interação:<br>
                        &nbsp;&nbsp;&nbsp;a) entre pessoas naturais ou entre pessoas jurídicas de direito privado;<br>
                        &nbsp;&nbsp;&nbsp;b) na qual seja permitido o anonimato;<br>
                        &nbsp;&nbsp;&nbsp;c) na qual seja dispensada a identificação do particular;<br>
                        III - aos sistemas de ouvidoria de entes públicos;<br>
                        IV - aos programas de assistência a vítimas e a testemunhas ameaçadas;<br>
                        V - às outras hipóteses nas quais deva ser dada garantia de preservação de sigilo da identidade do particular na atuação perante o ente público.<br><br>
                        
                        <strong>Aceitação</strong><br>
                        Ao prosseguir com a assinatura, declaro que:<br><br>
                        • Li e entendi os termos deste documento;<br>
                        • Concordo em assinar eletronicamente conforme a legislação vigente;<br>
                        • Estou ciente das minhas responsabilidades legais.<br><br>
                    </div>

                    <form method="POST" id="confirmForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="accept_terms" name="accept_terms" required>
                            <label class="form-check-label" for="accept_terms">
                                <strong>Li, compreendi e aceito integralmente os termos acima</strong>
                            </label>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="confirm_authorization" name="confirm_authorization" required>
                            <label class="form-check-label" for="confirm_authorization">
                                <strong>Confirmo que tenho autorização para assinar este documento</strong>
                            </label>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="assume_responsibility" name="assume_responsibility" required>
                            <label class="form-check-label" for="assume_responsibility">
                                <strong>Assumo total responsabilidade pelas consequências desta assinatura</strong>
                            </label>
                        </div>
                    </form>
                </div>

                <!-- Botões de Ação -->
                <div class="d-grid gap-2">
                    <a href="{{ url_for('client_select_document') }}" class="btn btn-outline-secondary btn-client client-confirm-btn-client">
                        <i class="fas fa-arrow-left me-2"></i>
                        Voltar
                    </a>
                    
                    <button type="submit" form="confirmForm" class="btn btn-success btn-client client-confirm-btn-client" id="proceedBtn" disabled>
                        <i class="fas fa-check me-2"></i>
                        Prosseguir para Assinatura
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script nonce="{{ csp_nonce() }}">
        // Elementos do DOM
        const acceptTerms = document.getElementById('accept_terms');
        const confirmAuthorization = document.getElementById('confirm_authorization');
        const assumeResponsibility = document.getElementById('assume_responsibility');
        const proceedBtn = document.getElementById('proceedBtn');
        
        // Função para verificar se todos os checkboxes estão marcados
        function checkAllTerms() {
            const allChecked = acceptTerms.checked && confirmAuthorization.checked && assumeResponsibility.checked;
            proceedBtn.disabled = !allChecked;
            console.log('Checkboxes:', {
                accept_terms: acceptTerms.checked,
                confirm_authorization: confirmAuthorization.checked,
                assume_responsibility: assumeResponsibility.checked,
                all_checked: allChecked
            });
        }
        
        // Event listeners para os checkboxes
        acceptTerms.addEventListener('change', checkAllTerms);
        confirmAuthorization.addEventListener('change', checkAllTerms);
        assumeResponsibility.addEventListener('change', checkAllTerms);
        
        // Foco automático no primeiro checkbox
        window.addEventListener('load', function() {
            acceptTerms.focus();
            checkAllTerms(); // Verifica estado inicial
        });
        
        // Suporte a tecla Enter
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !proceedBtn.disabled) {
                proceedBtn.click();
            }
        });
        
        // Debug: Log do estado dos checkboxes
        console.log('Template carregado. Elementos encontrados:', {
            acceptTerms: !!acceptTerms,
            confirmAuthorization: !!confirmAuthorization,
            assumeResponsibility: !!assumeResponsibility,
            proceedBtn: !!proceedBtn
        });
    </script>
</body>
</html>
